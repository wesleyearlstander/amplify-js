{"version":3,"file":"chatbot.component.core.js","sourceRoot":"","sources":["../../../../../src/components/interactions/chatbot/chatbot.component.core.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable\r\n/*\r\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\r\n * the License. A copy of the License is located at\r\n *\r\n *     http://aws.amazon.com/apache2.0/\r\n *\r\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\r\n * and limitations under the License.\r\n */\r\n// tslint:enable\r\n\r\nimport {\r\n\tComponent,\r\n\tInput,\r\n\tOutput,\r\n\tEventEmitter,\r\n\tOnInit,\r\n\tChangeDetectorRef,\r\n\tInject,\r\n} from '@angular/core';\r\nimport { AmplifyService } from '../../../providers/amplify.service';\r\nimport { isUndefined } from 'util';\r\nimport { chatBot } from '../../../assets/data-test-attributes';\r\nrequire('./aws-lex-audio.js');\r\n\r\nconst template = `\r\n<div class=\"amplify-interactions\">\r\n\t<div class=\"amplify-interactions-container\">\r\n\t\t<div class=\"amplify-form-container\">\r\n\t\t\t<div class=\"amplify-form-row\">\r\n\t\t\t\t<div class=\"amplify-interactions-conversation\">\r\n\t\t\t\t\t<div *ngFor=\"let message of messages\">\r\n\t\t\t\t\t\t<div class=\"amplify-interactions-input\">{{message.me}}</div>\r\n\t\t\t\t\t\t<div class=\"amplify-interactions-input-timestamp\">{{message.meSentTime}}</div>\r\n\t\t\t\t\t\t<div class=\"amplify-interactions-response\">{{message.bot}}</div>\r\n\t\t\t\t\t\t<div class=\"amplify-interactions-response-timestamp\">{{message.botSentTime}}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"amplify-interactions-actions\">\r\n\t\t\t\t<input #inputValue\r\n\t\t\t\t\tdata-test=\"${chatBot.messageInput}\"\r\n\t\t\t\t\ttype='text'\r\n\t\t\t\t\tclass=\"amplify-form-input\"\r\n\t\t\t\t\tplaceholder=\"{{currentVoiceState}}\"\r\n\t\t\t\t\t[value]=\"inputText\"\r\n\t\t\t\t\t(keyup.enter)=\"onSubmit(inputValue.value)\"\r\n\t\t\t\t\t(change)=\"onInputChange($event.target.value)\"\r\n\t\t\t\t\t[disabled]=\"inputDisabled\"\r\n\t\t\t\t\t*ngIf=\"textEnabled\">\r\n\t\t\t\t<input #inputValue\r\n\t\t\t\t\ttype='text'\r\n\t\t\t\t\tclass=\"amplify-form-input\"\r\n\t\t\t\t\tplaceholder=\"{{currentVoiceState}}\"\r\n\t\t\t\t\t[disabled]=\"!textEnabled\"\r\n\t\t\t\t\t*ngIf=\"!textEnabled\">\r\n\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t*ngIf=\"voiceEnabled\"\r\n\t\t\t\t\tng-style=\"{float: 'right'}\"\r\n\t\t\t\t\t(click)=\"micButtonHandler()\"\r\n\t\t\t\t\t[disabled]=\"micButtonDisabled\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{{micText}}\r\n\t\t\t\t</button>\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t*ngIf=\"textEnabled\"\r\n\t\t\t\t\tng-style=\"{float: 'right'}\"\r\n\t\t\t\t\tclass=\"amplify-interactions-button\"\r\n\t\t\t\t\t[disabled]=\"inputDisabled\"\r\n\t\t\t\t\tng-click=\"!inputDisabled || onSubmit(inputValue.value)\"\r\n\t\t\t\t></button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n`;\r\ndeclare var LexAudio: any;\r\n\r\nconst STATES = {\r\n\tINITIAL: { MESSAGE: 'Type your message or click  🎤', ICON: '🎤' },\r\n\tLISTENING: { MESSAGE: 'Listening... click 🔴 again to cancel', ICON: '🔴' },\r\n\tSENDING: { MESSAGE: 'Please wait...', ICON: '🔊' },\r\n\tSPEAKING: { MESSAGE: 'Speaking...', ICON: '...' },\r\n};\r\n\r\nconst defaultVoiceConfig = {\r\n\tsilenceDetectionConfig: {\r\n\t\ttime: 2000,\r\n\t\tamplitude: 0.2,\r\n\t},\r\n};\r\n\r\n@Component({\r\n\tselector: 'amplify-interactions-core',\r\n\ttemplate,\r\n})\r\nexport class ChatbotComponentCore implements OnInit {\r\n\terrorMessage: string;\r\n\tinputText: string = '';\r\n\tbotName: string;\r\n\tchatTitle: string;\r\n\tclearComplete: boolean = false;\r\n\tmessages: any = [];\r\n\tcompletions: any = {};\r\n\tcurrentVoiceState: string = STATES.INITIAL.MESSAGE;\r\n\tinputDisabled: boolean = false;\r\n\tmicText: string = STATES.INITIAL.ICON;\r\n\tvoiceConfig: any = defaultVoiceConfig;\r\n\tcontinueConversation: boolean = false;\r\n\tmicButtonDisabled: boolean = false;\r\n\taudioInput: any;\r\n\tlexResponse: any;\r\n\tconversationModeOn: boolean = false;\r\n\tref: ChangeDetectorRef;\r\n\tvoiceEnabled: boolean = false;\r\n\ttextEnabled: boolean = true;\r\n\taudioControl: any;\r\n\tprotected logger;\r\n\r\n\t@Output()\r\n\tcomplete: EventEmitter<string> = new EventEmitter<string>();\r\n\r\n\tconstructor(\r\n\t\tref: ChangeDetectorRef,\r\n\t\t@Inject(AmplifyService) public amplifyService: AmplifyService\r\n\t) {\r\n\t\tthis.ref = ref;\r\n\t\tthis.continueConversation = false;\r\n\t\tthis.logger = this.amplifyService.logger('ChatbotComponent');\r\n\t}\r\n\r\n\t@Input()\r\n\tset data(data: any) {\r\n\t\tthis.botName = data.bot;\r\n\t\tthis.chatTitle = data.title;\r\n\t\tthis.clearComplete = data.clearComplete;\r\n\t\tthis.conversationModeOn = isUndefined(data.conversationModeOn)\r\n\t\t\t? false\r\n\t\t\t: data.conversationModeOn;\r\n\t\tthis.voiceEnabled = isUndefined(data.voiceEnabled)\r\n\t\t\t? false\r\n\t\t\t: data.voiceEnabled;\r\n\t\tthis.textEnabled = isUndefined(data.textEnabled) ? true : data.textEnabled;\r\n\t\tthis.voiceConfig = data.voiceConfig || this.voiceConfig;\r\n\t\tthis.performOnComplete = this.performOnComplete.bind(this);\r\n\t\tthis.amplifyService\r\n\t\t\t.interactions()\r\n\t\t\t.onComplete(this.botName, this.performOnComplete);\r\n\r\n\t\tif (!this.textEnabled && this.voiceEnabled) {\r\n\t\t\tthis.currentVoiceState = 'Click the mic button';\r\n\t\t\tSTATES.INITIAL.MESSAGE = 'Click the mic button';\r\n\t\t}\r\n\r\n\t\tif (!this.voiceEnabled && this.textEnabled) {\r\n\t\t\tthis.currentVoiceState = 'Type a message';\r\n\t\t\tSTATES.INITIAL.MESSAGE = 'Type a message';\r\n\t\t}\r\n\r\n\t\tif (this.voiceEnabled) {\r\n\t\t\tthis.audioControl = new LexAudio.audioControl();\r\n\t\t}\r\n\t}\r\n\r\n\t@Input()\r\n\tset bot(botName: string) {\r\n\t\tthis.botName = botName;\r\n\t\tthis.performOnComplete = this.performOnComplete.bind(this);\r\n\t\tthis.amplifyService\r\n\t\t\t.interactions()\r\n\t\t\t.onComplete(botName, this.performOnComplete);\r\n\t}\r\n\r\n\t@Input()\r\n\tset title(title: string) {\r\n\t\tthis.chatTitle = title;\r\n\t}\r\n\r\n\t@Input()\r\n\tset clearOnComplete(clearComplete: boolean) {\r\n\t\tthis.clearComplete = clearComplete;\r\n\t}\r\n\r\n\tngOnInit() {\r\n\t\tif (!this.amplifyService.interactions()) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t'Interactions module not registered on AmplifyService provider'\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tperformOnComplete(evt) {\r\n\t\tthis.complete.emit(evt);\r\n\t\tif (this.clearComplete) {\r\n\t\t\tthis.messages = [];\r\n\t\t}\r\n\t}\r\n\r\n\tonInputChange(value: string) {\r\n\t\tthis.inputText = value;\r\n\t}\r\n\r\n\tonSubmit(e) {\r\n\t\tif (!this.inputText) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst message = {\r\n\t\t\tme: this.inputText,\r\n\t\t\tmeSentTime: new Date().toLocaleTimeString(),\r\n\t\t\tbot: '',\r\n\t\t\tbotSentTime: '',\r\n\t\t};\r\n\t\tthis.amplifyService\r\n\t\t\t.interactions()\r\n\t\t\t.send(this.botName, this.inputText)\r\n\t\t\t.then((response: any) => {\r\n\t\t\t\tthis.inputText = '';\r\n\t\t\t\tmessage.bot = response.message;\r\n\t\t\t\tmessage.botSentTime = new Date().toLocaleTimeString();\r\n\t\t\t\tthis.messages.push(message);\r\n\t\t\t})\r\n\t\t\t.catch(error => this.logger.error(error));\r\n\t}\r\n\r\n\tonSilenceHandler = () => {\r\n\t\tif (!this.continueConversation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.audioControl.exportWAV(blob => {\r\n\t\t\tthis.currentVoiceState = STATES.SENDING.MESSAGE;\r\n\t\t\tthis.audioInput = blob;\r\n\t\t\tthis.micText = STATES.SENDING.ICON;\r\n\t\t\tthis.micButtonDisabled = true;\r\n\t\t\tthis.lexResponseHandler();\r\n\t\t});\r\n\t\tthis.ref.detectChanges();\r\n\t};\r\n\r\n\treset() {\r\n\t\tthis.audioControl.clear();\r\n\t\tthis.inputText = '';\r\n\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\r\n\t\tthis.inputDisabled = false;\r\n\t\tthis.micText = STATES.INITIAL.ICON;\r\n\t\tthis.continueConversation = false;\r\n\t\tthis.micButtonDisabled = false;\r\n\t\tthis.ref.detectChanges();\r\n\t}\r\n\r\n\tonError(error) {\r\n\t\tthis.logger.error(error);\r\n\t}\r\n\r\n\tasync lexResponseHandler() {\r\n\t\tif (!this.continueConversation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst interactionsMessage = {\r\n\t\t\tcontent: this.audioInput,\r\n\t\t\toptions: {\r\n\t\t\t\tmessageType: 'voice',\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tconst response = await this.amplifyService\r\n\t\t\t.interactions()\r\n\t\t\t.send(this.botName, interactionsMessage);\r\n\r\n\t\tthis.lexResponse = response;\r\n\t\tthis.currentVoiceState = STATES.SPEAKING.MESSAGE;\r\n\t\tthis.micText = STATES.SPEAKING.ICON;\r\n\t\tthis.micButtonDisabled = true;\r\n\r\n\t\tconst message = {\r\n\t\t\tme: this.lexResponse.inputTranscript,\r\n\t\t\tmeSentTime: new Date().toLocaleTimeString(),\r\n\t\t\tbot: '',\r\n\t\t\tbotSentTime: '',\r\n\t\t};\r\n\r\n\t\tthis.inputText = '';\r\n\t\tmessage.bot = this.lexResponse.message;\r\n\t\tmessage.botSentTime = new Date().toLocaleTimeString();\r\n\t\tthis.messages.push(message);\r\n\t\tthis.doneSpeakingHandler();\r\n\t\tthis.ref.detectChanges();\r\n\t}\r\n\r\n\tdoneSpeakingHandler() {\r\n\t\tif (!this.continueConversation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.lexResponse.contentType === 'audio/mpeg') {\r\n\t\t\tthis.audioControl.play(this.lexResponse.audioStream, () => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tthis.lexResponse.dialogState === 'ReadyForFulfillment' ||\r\n\t\t\t\t\tthis.lexResponse.dialogState === 'Fulfilled' ||\r\n\t\t\t\t\tthis.lexResponse.dialogState === 'Failed' ||\r\n\t\t\t\t\t!this.conversationModeOn\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.inputDisabled = false;\r\n\t\t\t\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\r\n\t\t\t\t\tthis.micText = STATES.INITIAL.ICON;\r\n\t\t\t\t\tthis.micButtonDisabled = false;\r\n\t\t\t\t\tthis.continueConversation = false;\r\n\t\t\t\t\tthis.ref.detectChanges();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.currentVoiceState = STATES.LISTENING.MESSAGE;\r\n\t\t\t\t\tthis.micText = STATES.LISTENING.ICON;\r\n\t\t\t\t\tthis.micButtonDisabled = false;\r\n\t\t\t\t\tthis.audioControl.startRecording(\r\n\t\t\t\t\t\tthis.onSilenceHandler,\r\n\t\t\t\t\t\tnull,\r\n\t\t\t\t\t\tthis.voiceConfig.silenceDetectionConfig\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis.ref.detectChanges();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.inputDisabled = false;\r\n\t\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\r\n\t\t\tthis.micText = STATES.INITIAL.ICON;\r\n\t\t\tthis.micButtonDisabled = false;\r\n\t\t\tthis.continueConversation = false;\r\n\t\t\tthis.ref.detectChanges();\r\n\t\t}\r\n\t}\r\n\r\n\tasync micButtonHandler() {\r\n\t\tif (this.continueConversation) {\r\n\t\t\tthis.reset();\r\n\t\t\tthis.ref.detectChanges();\r\n\t\t} else {\r\n\t\t\tthis.inputDisabled = true;\r\n\t\t\tthis.continueConversation = true;\r\n\t\t\tthis.currentVoiceState = STATES.LISTENING.MESSAGE;\r\n\t\t\tthis.micText = STATES.LISTENING.ICON;\r\n\t\t\tthis.micButtonDisabled = false;\r\n\t\t\tthis.audioControl.startRecording(\r\n\t\t\t\tthis.onSilenceHandler,\r\n\t\t\t\tnull,\r\n\t\t\t\tthis.voiceConfig.silenceDetectionConfig\r\n\t\t\t);\r\n\t\t\tthis.ref.detectChanges();\r\n\t\t}\r\n\t}\r\n}\r\n"]}