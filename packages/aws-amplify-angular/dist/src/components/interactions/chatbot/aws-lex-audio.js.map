{"version":3,"file":"aws-lex-audio.js","sourceRoot":"","sources":["../../../../../src/components/interactions/chatbot/aws-lex-audio.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this\r\n// software and associated documentation files (the \"Software\"), to deal in the Software\r\n// without restriction, including without limitation the rights to use, copy, modify,\r\n// merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\r\n// permit persons to whom the Software is furnished to do so.\r\n\r\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\r\n// INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\r\n// PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\r\n// OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\r\n// SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n\r\n(function e(t, n, r) {\r\n\tfunction s(o, u) {\r\n\t\tif (!n[o]) {\r\n\t\t\tif (!t[o]) {\r\n\t\t\t\tvar a = typeof require == 'function' && require;\r\n\t\t\t\tif (!u && a) return a(o, !0);\r\n\t\t\t\tif (i) return i(o, !0);\r\n\t\t\t\tvar f = new Error(\"Cannot find module '\" + o + \"'\");\r\n\t\t\t\tthrow ((f.code = 'MODULE_NOT_FOUND'), f);\r\n\t\t\t}\r\n\t\t\tvar l = (n[o] = { exports: {} });\r\n\t\t\tt[o][0].call(\r\n\t\t\t\tl.exports,\r\n\t\t\t\tfunction(e) {\r\n\t\t\t\t\tvar n = t[o][1][e];\r\n\t\t\t\t\treturn s(n ? n : e);\r\n\t\t\t\t},\r\n\t\t\t\tl,\r\n\t\t\t\tl.exports,\r\n\t\t\t\te,\r\n\t\t\t\tt,\r\n\t\t\t\tn,\r\n\t\t\t\tr\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn n[o].exports;\r\n\t}\r\n\tvar i = typeof require == 'function' && require;\r\n\tfor (var o = 0; o < r.length; o++) s(r[o]);\r\n\treturn s;\r\n})(\r\n\t{\r\n\t\t1: [\r\n\t\t\tfunction(require, module, exports) {\r\n\t\t\t\t(function() {\r\n\t\t\t\t\t'use strict';\r\n\t\t\t\t\tvar rec = require('./recorder.js');\r\n\t\t\t\t\tvar recorder,\r\n\t\t\t\t\t\taudioRecorder,\r\n\t\t\t\t\t\tcheckAudioSupport,\r\n\t\t\t\t\t\taudioSupported,\r\n\t\t\t\t\t\tplaybackSource,\r\n\t\t\t\t\t\tUNSUPPORTED = 'Audio is not supported.';\r\n\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * Represents an audio control that can start and stop recording,\r\n\t\t\t\t\t * export captured audio, play an audio buffer, and check if audio\r\n\t\t\t\t\t * is supported.\r\n\t\t\t\t\t */\r\n\t\t\t\t\texports.audioControl = function(options) {\r\n\t\t\t\t\t\toptions = options || {};\r\n\t\t\t\t\t\tthis.checkAudioSupport = options.checkAudioSupport !== false;\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * This callback type is called `onSilenceCallback`.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @callback onSilenceCallback\r\n\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Visualize callback: `visualizerCallback`.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @callback visualizerCallback\r\n\t\t\t\t\t\t * @param {Uint8Array} dataArray\r\n\t\t\t\t\t\t * @param {number} bufferLength\r\n\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Clears the previous buffer and starts buffering audio.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @param {?onSilenceCallback} onSilence - Called when silence is detected.\r\n\t\t\t\t\t\t * @param {?visualizerCallback} visualizer - Can be used to visualize the captured buffer.\r\n\t\t\t\t\t\t * @param {silenceDetectionConfig} - Specify custom silence detection values.\r\n\t\t\t\t\t\t * @throws {Error} If audio is not supported.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar startRecording = function(\r\n\t\t\t\t\t\t\tonSilence,\r\n\t\t\t\t\t\t\tvisualizer,\r\n\t\t\t\t\t\t\tsilenceDetectionConfig\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tonSilence =\r\n\t\t\t\t\t\t\t\tonSilence ||\r\n\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t/* no op */\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvisualizer =\r\n\t\t\t\t\t\t\t\tvisualizer ||\r\n\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t/* no op */\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\taudioSupported = audioSupported !== false;\r\n\t\t\t\t\t\t\tif (!audioSupported) {\r\n\t\t\t\t\t\t\t\tthrow new Error(UNSUPPORTED);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst context = audioRecorder.audioContext();\r\n\t\t\t\t\t\t\tcontext.resume().then(() => {\r\n\t\t\t\t\t\t\t\trecorder = audioRecorder.createRecorder(silenceDetectionConfig);\r\n\t\t\t\t\t\t\t\trecorder.record(onSilence, visualizer);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Stops buffering audio.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @throws {Error} If audio is not supported.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar stopRecording = function() {\r\n\t\t\t\t\t\t\taudioSupported = audioSupported !== false;\r\n\t\t\t\t\t\t\tif (!audioSupported) {\r\n\t\t\t\t\t\t\t\tthrow new Error(UNSUPPORTED);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\trecorder.stop();\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * On export complete callback: `onExportComplete`.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @callback onExportComplete\r\n\t\t\t\t\t\t * @param {Blob} blob The exported audio as a Blob.\r\n\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Exports the captured audio buffer.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @param {onExportComplete} callback - Called when the export is complete.\r\n\t\t\t\t\t\t * @param {sampleRate} The sample rate to use in the export.\r\n\t\t\t\t\t\t * @throws {Error} If audio is not supported.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar exportWAV = function(callback, sampleRate) {\r\n\t\t\t\t\t\t\taudioSupported = audioSupported !== false;\r\n\t\t\t\t\t\t\tif (!audioSupported) {\r\n\t\t\t\t\t\t\t\tthrow new Error(UNSUPPORTED);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!(callback && typeof callback === 'function')) {\r\n\t\t\t\t\t\t\t\tthrow new Error('You must pass a callback function to export.');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsampleRate =\r\n\t\t\t\t\t\t\t\ttypeof sampleRate !== 'undefined' ? sampleRate : 16000;\r\n\t\t\t\t\t\t\trecorder.exportWAV(callback, sampleRate);\r\n\t\t\t\t\t\t\trecorder.clear();\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * On playback complete callback: `onPlaybackComplete`.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @callback onPlaybackComplete\r\n\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Plays the audio buffer with an HTML5 audio tag.\r\n\t\t\t\t\t\t * @param {Uint8Array} buffer - The audio buffer to play.\r\n\t\t\t\t\t\t * @param {?onPlaybackComplete} callback - Called when audio playback is complete.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar playHtmlAudioElement = function(buffer, callback) {\r\n\t\t\t\t\t\t\tif (typeof buffer === 'undefined') {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar myBlob = new Blob([buffer]);\r\n\t\t\t\t\t\t\tvar audio = document.createElement('audio');\r\n\t\t\t\t\t\t\tvar objectUrl = window.URL.createObjectURL(myBlob);\r\n\t\t\t\t\t\t\taudio.src = objectUrl;\r\n\t\t\t\t\t\t\taudio.addEventListener('ended', function() {\r\n\t\t\t\t\t\t\t\taudio.currentTime = 0;\r\n\t\t\t\t\t\t\t\tif (typeof callback === 'function') {\r\n\t\t\t\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\taudio.play();\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * On playback complete callback: `onPlaybackComplete`.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @callback onPlaybackComplete\r\n\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Plays the audio buffer with a WebAudio AudioBufferSourceNode.\r\n\t\t\t\t\t\t * @param {Uint8Array} buffer - The audio buffer to play.\r\n\t\t\t\t\t\t * @param {?onPlaybackComplete} callback - Called when audio playback is complete.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar play = function(buffer, callback) {\r\n\t\t\t\t\t\t\tif (typeof buffer === 'undefined') {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar myBlob = new Blob([buffer]);\r\n\t\t\t\t\t\t\t// We'll use a FileReader to create and ArrayBuffer out of the audio response.\r\n\t\t\t\t\t\t\tvar fileReader = new FileReader();\r\n\t\t\t\t\t\t\tfileReader.onload = function() {\r\n\t\t\t\t\t\t\t\t// Once we have an ArrayBuffer we can create our BufferSource and decode the result as an AudioBuffer.\r\n\t\t\t\t\t\t\t\tplaybackSource = audioRecorder\r\n\t\t\t\t\t\t\t\t\t.audioContext()\r\n\t\t\t\t\t\t\t\t\t.createBufferSource();\r\n\t\t\t\t\t\t\t\taudioRecorder\r\n\t\t\t\t\t\t\t\t\t.audioContext()\r\n\t\t\t\t\t\t\t\t\t.decodeAudioData(this.result, function(buf) {\r\n\t\t\t\t\t\t\t\t\t\t// Set the source buffer as our new AudioBuffer.\r\n\t\t\t\t\t\t\t\t\t\tplaybackSource.buffer = buf;\r\n\t\t\t\t\t\t\t\t\t\t// Set the destination (the actual audio-rendering device--your device's speakers).\r\n\t\t\t\t\t\t\t\t\t\tplaybackSource.connect(\r\n\t\t\t\t\t\t\t\t\t\t\taudioRecorder.audioContext().destination\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t// Add an \"on ended\" callback.\r\n\t\t\t\t\t\t\t\t\t\tplaybackSource.onended = function(event) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (typeof callback === 'function') {\r\n\t\t\t\t\t\t\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\t// Start the playback.\r\n\t\t\t\t\t\t\t\t\t\tplaybackSource.start(0);\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tfileReader.readAsArrayBuffer(myBlob);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Stops the playback source (created by the play method) if it exists. The `onPlaybackComplete`\r\n\t\t\t\t\t\t * callback will be called.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar stop = function() {\r\n\t\t\t\t\t\t\tif (typeof playbackSource === 'undefined') {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tplaybackSource.stop();\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Clear the recording buffer.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar clear = function() {\r\n\t\t\t\t\t\t\trecorder.clear();\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * On audio supported callback: `onAudioSupported`.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t * @callback onAudioSupported\r\n\t\t\t\t\t\t * @param {boolean}\r\n\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Checks that getUserMedia is supported and the user has given us access to the mic.\r\n\t\t\t\t\t\t * @param {onAudioSupported} callback - Called with the result.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar supportsAudio = function(callback) {\r\n\t\t\t\t\t\t\tcallback =\r\n\t\t\t\t\t\t\t\tcallback ||\r\n\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t/* no op */\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tnavigator.mediaDevices &&\r\n\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\taudioRecorder = rec.audioRecorder();\r\n\t\t\t\t\t\t\t\taudioRecorder\r\n\t\t\t\t\t\t\t\t\t.requestDevice()\r\n\t\t\t\t\t\t\t\t\t.then(function(stream) {\r\n\t\t\t\t\t\t\t\t\t\taudioSupported = true;\r\n\t\t\t\t\t\t\t\t\t\tcallback(audioSupported);\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\taudioSupported = false;\r\n\t\t\t\t\t\t\t\t\t\tcallback(audioSupported);\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\taudioSupported = false;\r\n\t\t\t\t\t\t\t\tcallback(audioSupported);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tif (this.checkAudioSupport) {\r\n\t\t\t\t\t\t\tsupportsAudio();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tstartRecording: startRecording,\r\n\t\t\t\t\t\t\tstopRecording: stopRecording,\r\n\t\t\t\t\t\t\texportWAV: exportWAV,\r\n\t\t\t\t\t\t\tplay: play,\r\n\t\t\t\t\t\t\tstop: stop,\r\n\t\t\t\t\t\t\tclear: clear,\r\n\t\t\t\t\t\t\tplayHtmlAudioElement: playHtmlAudioElement,\r\n\t\t\t\t\t\t\tsupportsAudio: supportsAudio,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\t\t\t\t})();\r\n\t\t\t},\r\n\t\t\t{ './recorder.js': 5 },\r\n\t\t],\r\n\t\t2: [\r\n\t\t\tfunction(require, module, exports) {\r\n\t\t\t\t(function() {\r\n\t\t\t\t\t'use strict';\r\n\t\t\t\t\tvar AudioControl = require('./control.js').audioControl;\r\n\r\n\t\t\t\t\tvar DEFAULT_LATEST = '$LATEST';\r\n\t\t\t\t\tvar DEFAULT_CONTENT_TYPE = 'audio/x-l16; sample-rate=16000';\r\n\t\t\t\t\tvar DEFAULT_USER_ID = 'userId';\r\n\t\t\t\t\tvar DEFAULT_ACCEPT_HEADER_VALUE = 'audio/mpeg';\r\n\t\t\t\t\tvar MESSAGES = Object.freeze({\r\n\t\t\t\t\t\tPASSIVE: 'Passive',\r\n\t\t\t\t\t\tLISTENING: 'Listening',\r\n\t\t\t\t\t\tSENDING: 'Sending',\r\n\t\t\t\t\t\tSPEAKING: 'Speaking',\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvar lexruntime,\r\n\t\t\t\t\t\taudioControl = new AudioControl({ checkAudioSupport: false });\r\n\r\n\t\t\t\t\texports.conversation = function(\r\n\t\t\t\t\t\tconfig,\r\n\t\t\t\t\t\tonStateChange,\r\n\t\t\t\t\t\tonSuccess,\r\n\t\t\t\t\t\tonError,\r\n\t\t\t\t\t\tonAudioData\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tvar currentState;\r\n\r\n\t\t\t\t\t\t// Apply default values.\r\n\t\t\t\t\t\tthis.config = applyDefaults(config);\r\n\t\t\t\t\t\tthis.lexConfig = this.config.lexConfig;\r\n\t\t\t\t\t\tthis.messages = MESSAGES;\r\n\t\t\t\t\t\tonStateChange =\r\n\t\t\t\t\t\t\tonStateChange ||\r\n\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t/* no op */\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.onSuccess =\r\n\t\t\t\t\t\t\tonSuccess ||\r\n\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t/* no op */\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.onError =\r\n\t\t\t\t\t\t\tonError ||\r\n\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t/* no op */\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.onAudioData =\r\n\t\t\t\t\t\t\tonAudioData ||\r\n\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t/* no op */\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Validate input.\r\n\t\t\t\t\t\tif (!this.config.lexConfig.botName) {\r\n\t\t\t\t\t\t\tthis.onError('A Bot name must be provided.');\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!AWS.config.credentials) {\r\n\t\t\t\t\t\t\tthis.onError('AWS Credentials must be provided.');\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!AWS.config.region) {\r\n\t\t\t\t\t\t\tthis.onError('A Region value must be provided.');\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlexruntime = new AWS.LexRuntime();\r\n\r\n\t\t\t\t\t\tthis.onSilence = function() {\r\n\t\t\t\t\t\t\tif (config.silenceDetection) {\r\n\t\t\t\t\t\t\t\taudioControl.stopRecording();\r\n\t\t\t\t\t\t\t\tcurrentState.advanceConversation();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tthis.transition = function(conversation) {\r\n\t\t\t\t\t\t\tcurrentState = conversation;\r\n\t\t\t\t\t\t\tvar state = currentState.state;\r\n\t\t\t\t\t\t\tonStateChange(state.message);\r\n\r\n\t\t\t\t\t\t\t// If we are transitioning into SENDING or SPEAKING we want to immediately advance the conversation state\r\n\t\t\t\t\t\t\t// to start the service call or playback.\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tstate.message === state.messages.SENDING ||\r\n\t\t\t\t\t\t\t\tstate.message === state.messages.SPEAKING\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tcurrentState.advanceConversation();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// If we are transitioning in to sending and we are not detecting silence (this was a manual state change)\r\n\t\t\t\t\t\t\t// we need to do some cleanup: stop recording, and stop rendering.\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tstate.message === state.messages.SENDING &&\r\n\t\t\t\t\t\t\t\t!this.config.silenceDetection\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\taudioControl.stopRecording();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tthis.advanceConversation = function() {\r\n\t\t\t\t\t\t\taudioControl.supportsAudio(function(supported) {\r\n\t\t\t\t\t\t\t\tif (supported) {\r\n\t\t\t\t\t\t\t\t\tcurrentState.advanceConversation();\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tonError('Audio is not supported.');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tthis.updateConfig = function(newValue) {\r\n\t\t\t\t\t\t\tthis.config = applyDefaults(newValue);\r\n\t\t\t\t\t\t\tthis.lexConfig = this.config.lexConfig;\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tthis.reset = function() {\r\n\t\t\t\t\t\t\taudioControl.clear();\r\n\t\t\t\t\t\t\tcurrentState = new Initial(currentState.state);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tcurrentState = new Initial(this);\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tadvanceConversation: this.advanceConversation,\r\n\t\t\t\t\t\t\tupdateConfig: this.updateConfig,\r\n\t\t\t\t\t\t\treset: this.reset,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar Initial = function(state) {\r\n\t\t\t\t\t\tthis.state = state;\r\n\t\t\t\t\t\tstate.message = state.messages.PASSIVE;\r\n\t\t\t\t\t\tthis.advanceConversation = function() {\r\n\t\t\t\t\t\t\taudioControl.startRecording(\r\n\t\t\t\t\t\t\t\tstate.onSilence,\r\n\t\t\t\t\t\t\t\tstate.onAudioData,\r\n\t\t\t\t\t\t\t\tstate.config.silenceDetectionConfig\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tstate.transition(new Listening(state));\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar Listening = function(state) {\r\n\t\t\t\t\t\tthis.state = state;\r\n\t\t\t\t\t\tstate.message = state.messages.LISTENING;\r\n\t\t\t\t\t\tthis.advanceConversation = function() {\r\n\t\t\t\t\t\t\taudioControl.exportWAV(function(blob) {\r\n\t\t\t\t\t\t\t\tstate.audioInput = blob;\r\n\t\t\t\t\t\t\t\tstate.transition(new Sending(state));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar Sending = function(state) {\r\n\t\t\t\t\t\tthis.state = state;\r\n\t\t\t\t\t\tstate.message = state.messages.SENDING;\r\n\t\t\t\t\t\tthis.advanceConversation = function() {\r\n\t\t\t\t\t\t\tstate.lexConfig.inputStream = state.audioInput;\r\n\t\t\t\t\t\t\tlexruntime.postContent(state.lexConfig, function(err, data) {\r\n\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\tstate.onError(err);\r\n\t\t\t\t\t\t\t\t\tstate.transition(new Initial(state));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tstate.audioOutput = data;\r\n\t\t\t\t\t\t\t\t\tstate.transition(new Speaking(state));\r\n\t\t\t\t\t\t\t\t\tstate.onSuccess(data);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar Speaking = function(state) {\r\n\t\t\t\t\t\tthis.state = state;\r\n\t\t\t\t\t\tstate.message = state.messages.SPEAKING;\r\n\t\t\t\t\t\tthis.advanceConversation = function() {\r\n\t\t\t\t\t\t\tif (state.audioOutput.contentType === 'audio/mpeg') {\r\n\t\t\t\t\t\t\t\taudioControl.play(state.audioOutput.audioStream, function() {\r\n\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\tstate.audioOutput.dialogState === 'ReadyForFulfillment' ||\r\n\t\t\t\t\t\t\t\t\t\tstate.audioOutput.dialogState === 'Fulfilled' ||\r\n\t\t\t\t\t\t\t\t\t\tstate.audioOutput.dialogState === 'Failed' ||\r\n\t\t\t\t\t\t\t\t\t\t!state.config.silenceDetection\r\n\t\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t\tstate.transition(new Initial(state));\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\taudioControl.startRecording(\r\n\t\t\t\t\t\t\t\t\t\t\tstate.onSilence,\r\n\t\t\t\t\t\t\t\t\t\t\tstate.onAudioData,\r\n\t\t\t\t\t\t\t\t\t\t\tstate.config.silenceDetectionConfig\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\tstate.transition(new Listening(state));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tstate.transition(new Initial(state));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar applyDefaults = function(config) {\r\n\t\t\t\t\t\tconfig = config || {};\r\n\t\t\t\t\t\tconfig.silenceDetection = config.hasOwnProperty('silenceDetection')\r\n\t\t\t\t\t\t\t? config.silenceDetection\r\n\t\t\t\t\t\t\t: true;\r\n\r\n\t\t\t\t\t\tvar lexConfig = config.lexConfig || {};\r\n\t\t\t\t\t\tlexConfig.botAlias = lexConfig.hasOwnProperty('botAlias')\r\n\t\t\t\t\t\t\t? lexConfig.botAlias\r\n\t\t\t\t\t\t\t: DEFAULT_LATEST;\r\n\t\t\t\t\t\tlexConfig.botName = lexConfig.hasOwnProperty('botName')\r\n\t\t\t\t\t\t\t? lexConfig.botName\r\n\t\t\t\t\t\t\t: '';\r\n\t\t\t\t\t\tlexConfig.contentType = lexConfig.hasOwnProperty('contentType')\r\n\t\t\t\t\t\t\t? lexConfig.contentType\r\n\t\t\t\t\t\t\t: DEFAULT_CONTENT_TYPE;\r\n\t\t\t\t\t\tlexConfig.userId = lexConfig.hasOwnProperty('userId')\r\n\t\t\t\t\t\t\t? lexConfig.userId\r\n\t\t\t\t\t\t\t: DEFAULT_USER_ID;\r\n\t\t\t\t\t\tlexConfig.accept = lexConfig.hasOwnProperty('accept')\r\n\t\t\t\t\t\t\t? lexConfig.accept\r\n\t\t\t\t\t\t\t: DEFAULT_ACCEPT_HEADER_VALUE;\r\n\t\t\t\t\t\tconfig.lexConfig = lexConfig;\r\n\r\n\t\t\t\t\t\treturn config;\r\n\t\t\t\t\t};\r\n\t\t\t\t})();\r\n\t\t\t},\r\n\t\t\t{ './control.js': 1 },\r\n\t\t],\r\n\t\t3: [\r\n\t\t\tfunction(require, module, exports) {\r\n\t\t\t\t(function(global) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * @module LexAudio\r\n\t\t\t\t\t * @description The global namespace for Amazon Lex Audio\r\n\t\t\t\t\t */\r\n\t\t\t\t\tglobal.LexAudio = global.LexAudio || {};\r\n\t\t\t\t\tglobal.LexAudio.audioControl = require('./control.js').audioControl;\r\n\t\t\t\t\tglobal.LexAudio.conversation = require('./conversation.js').conversation;\r\n\t\t\t\t\tmodule.exports = global.LexAudio;\r\n\t\t\t\t}.call(\r\n\t\t\t\t\tthis,\r\n\t\t\t\t\ttypeof global !== 'undefined'\r\n\t\t\t\t\t\t? global\r\n\t\t\t\t\t\t: typeof self !== 'undefined'\r\n\t\t\t\t\t\t? self\r\n\t\t\t\t\t\t: typeof window !== 'undefined'\r\n\t\t\t\t\t\t? window\r\n\t\t\t\t\t\t: {}\r\n\t\t\t\t));\r\n\t\t\t},\r\n\t\t\t{ './control.js': 1, './conversation.js': 2 },\r\n\t\t],\r\n\t\t4: [\r\n\t\t\tfunction(require, module, exports) {\r\n\t\t\t\tvar bundleFn = arguments[3];\r\n\t\t\t\tvar sources = arguments[4];\r\n\t\t\t\tvar cache = arguments[5];\r\n\r\n\t\t\t\tvar stringify = JSON.stringify;\r\n\r\n\t\t\t\tmodule.exports = function(fn, options) {\r\n\t\t\t\t\tvar wkey;\r\n\t\t\t\t\tvar cacheKeys = Object.keys(cache);\r\n\r\n\t\t\t\t\tfor (var i = 0, l = cacheKeys.length; i < l; i++) {\r\n\t\t\t\t\t\tvar key = cacheKeys[i];\r\n\t\t\t\t\t\tvar exp = cache[key].exports;\r\n\t\t\t\t\t\t// Using babel as a transpiler to use esmodule, the export will always\r\n\t\t\t\t\t\t// be an object with the default export as a property of it. To ensure\r\n\t\t\t\t\t\t// the existing api and babel esmodule exports are both supported we\r\n\t\t\t\t\t\t// check for both\r\n\t\t\t\t\t\tif (exp === fn || (exp && exp.default === fn)) {\r\n\t\t\t\t\t\t\twkey = key;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!wkey) {\r\n\t\t\t\t\t\twkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\r\n\t\t\t\t\t\tvar wcache = {};\r\n\t\t\t\t\t\tfor (var i = 0, l = cacheKeys.length; i < l; i++) {\r\n\t\t\t\t\t\t\tvar key = cacheKeys[i];\r\n\t\t\t\t\t\t\twcache[key] = key;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsources[wkey] = [\r\n\t\t\t\t\t\t\tFunction(['require', 'module', 'exports'], '(' + fn + ')(self)'),\r\n\t\t\t\t\t\t\twcache,\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\r\n\r\n\t\t\t\t\tvar scache = {};\r\n\t\t\t\t\tscache[wkey] = wkey;\r\n\t\t\t\t\tsources[skey] = [\r\n\t\t\t\t\t\tFunction(\r\n\t\t\t\t\t\t\t['require'],\r\n\t\t\t\t\t\t\t// try to call default if defined to also support babel esmodule\r\n\t\t\t\t\t\t\t// exports\r\n\t\t\t\t\t\t\t'var f = require(' +\r\n\t\t\t\t\t\t\t\tstringify(wkey) +\r\n\t\t\t\t\t\t\t\t');' +\r\n\t\t\t\t\t\t\t\t'(f.default ? f.default : f)(self);'\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tscache,\r\n\t\t\t\t\t];\r\n\r\n\t\t\t\t\tvar workerSources = {};\r\n\t\t\t\t\tresolveSources(skey);\r\n\r\n\t\t\t\t\tfunction resolveSources(key) {\r\n\t\t\t\t\t\tworkerSources[key] = true;\r\n\r\n\t\t\t\t\t\tfor (var depPath in sources[key][1]) {\r\n\t\t\t\t\t\t\tvar depKey = sources[key][1][depPath];\r\n\t\t\t\t\t\t\tif (!workerSources[depKey]) {\r\n\t\t\t\t\t\t\t\tresolveSources(depKey);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar src =\r\n\t\t\t\t\t\t'(' +\r\n\t\t\t\t\t\tbundleFn +\r\n\t\t\t\t\t\t')({' +\r\n\t\t\t\t\t\tObject.keys(workerSources)\r\n\t\t\t\t\t\t\t.map(function(key) {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\tstringify(key) +\r\n\t\t\t\t\t\t\t\t\t':[' +\r\n\t\t\t\t\t\t\t\t\tsources[key][0] +\r\n\t\t\t\t\t\t\t\t\t',' +\r\n\t\t\t\t\t\t\t\t\tstringify(sources[key][1]) +\r\n\t\t\t\t\t\t\t\t\t']'\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.join(',') +\r\n\t\t\t\t\t\t'},{},[' +\r\n\t\t\t\t\t\tstringify(skey) +\r\n\t\t\t\t\t\t'])';\r\n\t\t\t\t\tvar URL =\r\n\t\t\t\t\t\twindow.URL || window.webkitURL || window.mozURL || window.msURL;\r\n\r\n\t\t\t\t\tvar blob = new Blob([src], { type: 'text/javascript' });\r\n\t\t\t\t\tif (options && options.bare) {\r\n\t\t\t\t\t\treturn blob;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar workerUrl = URL.createObjectURL(blob);\r\n\t\t\t\t\tvar worker = new Worker(workerUrl);\r\n\t\t\t\t\tworker.objectURL = workerUrl;\r\n\t\t\t\t\treturn worker;\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\t{},\r\n\t\t],\r\n\t\t5: [\r\n\t\t\tfunction(require, module, exports) {\r\n\t\t\t\t(function() {\r\n\t\t\t\t\t'use strict';\r\n\t\t\t\t\tvar work = require('webworkify');\r\n\t\t\t\t\tvar worker = work(require('./worker.js'));\r\n\t\t\t\t\tvar audio_context, audio_stream;\r\n\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * The Recorder object. Sets up the onaudioprocess callback and communicates\r\n\t\t\t\t\t * with the web worker to perform audio actions.\r\n\t\t\t\t\t */\r\n\t\t\t\t\tvar recorder = function(source, silenceDetectionConfig) {\r\n\t\t\t\t\t\tsilenceDetectionConfig = silenceDetectionConfig || {};\r\n\t\t\t\t\t\tsilenceDetectionConfig.time = silenceDetectionConfig.hasOwnProperty(\r\n\t\t\t\t\t\t\t'time'\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t? silenceDetectionConfig.time\r\n\t\t\t\t\t\t\t: 1500;\r\n\t\t\t\t\t\tsilenceDetectionConfig.amplitude = silenceDetectionConfig.hasOwnProperty(\r\n\t\t\t\t\t\t\t'amplitude'\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t? silenceDetectionConfig.amplitude\r\n\t\t\t\t\t\t\t: 0.2;\r\n\r\n\t\t\t\t\t\tvar recording = false,\r\n\t\t\t\t\t\t\tcurrCallback,\r\n\t\t\t\t\t\t\tstart,\r\n\t\t\t\t\t\t\tsilenceCallback,\r\n\t\t\t\t\t\t\tvisualizationCallback;\r\n\r\n\t\t\t\t\t\t// Create a ScriptProcessorNode with a bufferSize of 4096 and a single input and output channel\r\n\t\t\t\t\t\tvar node = source.context.createScriptProcessor(4096, 1, 1);\r\n\r\n\t\t\t\t\t\tworker.onmessage = function(message) {\r\n\t\t\t\t\t\t\tvar blob = message.data;\r\n\t\t\t\t\t\t\tcurrCallback(blob);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tworker.postMessage({\r\n\t\t\t\t\t\t\tcommand: 'init',\r\n\t\t\t\t\t\t\tconfig: {\r\n\t\t\t\t\t\t\t\tsampleRate: source.context.sampleRate,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Sets the silence and viz callbacks, resets the silence start time, and sets recording to true.\r\n\t\t\t\t\t\t * @param {?onSilenceCallback} onSilence - Called when silence is detected.\r\n\t\t\t\t\t\t * @param {?visualizerCallback} visualizer - Can be used to visualize the captured buffer.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar record = function(onSilence, visualizer) {\r\n\t\t\t\t\t\t\tsilenceCallback = onSilence;\r\n\t\t\t\t\t\t\tvisualizationCallback = visualizer;\r\n\t\t\t\t\t\t\tstart = Date.now();\r\n\t\t\t\t\t\t\trecording = true;\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Sets recording to false.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar stop = function() {\r\n\t\t\t\t\t\t\trecording = false;\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Posts \"clear\" message to the worker.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar clear = function() {\r\n\t\t\t\t\t\t\tstop();\r\n\t\t\t\t\t\t\tworker.postMessage({ command: 'clear' });\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Sets the export callback and posts an \"export\" message to the worker.\r\n\t\t\t\t\t\t * @param {onExportComplete} callback - Called when the export is complete.\r\n\t\t\t\t\t\t * @param {sampleRate} The sample rate to use in the export.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar exportWAV = function(callback, sampleRate) {\r\n\t\t\t\t\t\t\tcurrCallback = callback;\r\n\t\t\t\t\t\t\tworker.postMessage({\r\n\t\t\t\t\t\t\t\tcommand: 'export',\r\n\t\t\t\t\t\t\t\tsampleRate: sampleRate,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Checks the time domain data to see if the amplitude of the audio waveform is more than\r\n\t\t\t\t\t\t * the silence threshold. If it is, \"noise\" has been detected and it resets the start time.\r\n\t\t\t\t\t\t * If the elapsed time reaches the time threshold the silence callback is called. If there is a\r\n\t\t\t\t\t\t * visualizationCallback it invokes the visualization callback with the time domain data.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar analyse = function() {\r\n\t\t\t\t\t\t\tanalyser.fftSize = 2048;\r\n\t\t\t\t\t\t\tvar bufferLength = analyser.fftSize;\r\n\t\t\t\t\t\t\tvar dataArray = new Uint8Array(bufferLength);\r\n\t\t\t\t\t\t\tvar amplitude = silenceDetectionConfig.amplitude;\r\n\t\t\t\t\t\t\tvar time = silenceDetectionConfig.time;\r\n\r\n\t\t\t\t\t\t\tanalyser.getByteTimeDomainData(dataArray);\r\n\r\n\t\t\t\t\t\t\tif (typeof visualizationCallback === 'function') {\r\n\t\t\t\t\t\t\t\tvisualizationCallback(dataArray, bufferLength);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tfor (var i = 0; i < bufferLength; i++) {\r\n\t\t\t\t\t\t\t\t// Normalize between -1 and 1.\r\n\t\t\t\t\t\t\t\tvar curr_value_time = dataArray[i] / 128 - 1.0;\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\tcurr_value_time > amplitude ||\r\n\t\t\t\t\t\t\t\t\tcurr_value_time < -1 * amplitude\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\tstart = Date.now();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar newtime = Date.now();\r\n\t\t\t\t\t\t\tvar elapsedTime = newtime - start;\r\n\t\t\t\t\t\t\tif (elapsedTime > time) {\r\n\t\t\t\t\t\t\t\tsilenceCallback();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * The onaudioprocess event handler of the ScriptProcessorNode interface. It is the EventHandler to be\r\n\t\t\t\t\t\t * called for the audioprocess event that is dispatched to ScriptProcessorNode node types.\r\n\t\t\t\t\t\t * @param {AudioProcessingEvent} audioProcessingEvent - The audio processing event.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tnode.onaudioprocess = function(audioProcessingEvent) {\r\n\t\t\t\t\t\t\tif (!recording) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tworker.postMessage({\r\n\t\t\t\t\t\t\t\tcommand: 'record',\r\n\t\t\t\t\t\t\t\tbuffer: [audioProcessingEvent.inputBuffer.getChannelData(0)],\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tanalyse();\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tvar analyser = source.context.createAnalyser();\r\n\t\t\t\t\t\tanalyser.minDecibels = -90;\r\n\t\t\t\t\t\tanalyser.maxDecibels = -10;\r\n\t\t\t\t\t\tanalyser.smoothingTimeConstant = 0.85;\r\n\r\n\t\t\t\t\t\tsource.connect(analyser);\r\n\t\t\t\t\t\tanalyser.connect(node);\r\n\t\t\t\t\t\tnode.connect(source.context.destination);\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\trecord: record,\r\n\t\t\t\t\t\t\tstop: stop,\r\n\t\t\t\t\t\t\tclear: clear,\r\n\t\t\t\t\t\t\texportWAV: exportWAV,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * Audio recorder object. Handles setting up the audio context,\r\n\t\t\t\t\t * accessing the mike, and creating the Recorder object.\r\n\t\t\t\t\t */\r\n\t\t\t\t\texports.audioRecorder = function() {\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Creates an audio context and calls getUserMedia to request the mic (audio).\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tvar requestDevice = function() {\r\n\t\t\t\t\t\t\tif (typeof audio_context === 'undefined') {\r\n\t\t\t\t\t\t\t\twindow.AudioContext =\r\n\t\t\t\t\t\t\t\t\twindow.AudioContext || window.webkitAudioContext;\r\n\t\t\t\t\t\t\t\taudio_context = new AudioContext();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn navigator.mediaDevices\r\n\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\r\n\t\t\t\t\t\t\t\t.then(function(stream) {\r\n\t\t\t\t\t\t\t\t\taudio_stream = stream;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tvar createRecorder = function(silenceDetectionConfig) {\r\n\t\t\t\t\t\t\treturn recorder(\r\n\t\t\t\t\t\t\t\taudio_context.createMediaStreamSource(audio_stream),\r\n\t\t\t\t\t\t\t\tsilenceDetectionConfig\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tvar audioContext = function() {\r\n\t\t\t\t\t\t\treturn audio_context;\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\trequestDevice: requestDevice,\r\n\t\t\t\t\t\t\tcreateRecorder: createRecorder,\r\n\t\t\t\t\t\t\taudioContext: audioContext,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\t\t\t\t})();\r\n\t\t\t},\r\n\t\t\t{ './worker.js': 6, webworkify: 4 },\r\n\t\t],\r\n\t\t6: [\r\n\t\t\tfunction(require, module, exports) {\r\n\t\t\t\tmodule.exports = function(self) {\r\n\t\t\t\t\t'use strict';\r\n\t\t\t\t\tvar recLength = 0,\r\n\t\t\t\t\t\trecBuffer = [],\r\n\t\t\t\t\t\trecordSampleRate;\r\n\r\n\t\t\t\t\tself.addEventListener('message', function(e) {\r\n\t\t\t\t\t\tswitch (e.data.command) {\r\n\t\t\t\t\t\t\tcase 'init':\r\n\t\t\t\t\t\t\t\tinit(e.data.config);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'record':\r\n\t\t\t\t\t\t\t\trecord(e.data.buffer);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'export':\r\n\t\t\t\t\t\t\t\texportBuffer(e.data.sampleRate);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'clear':\r\n\t\t\t\t\t\t\t\tclear();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tfunction init(config) {\r\n\t\t\t\t\t\trecordSampleRate = config.sampleRate;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction record(inputBuffer) {\r\n\t\t\t\t\t\trecBuffer.push(inputBuffer[0]);\r\n\t\t\t\t\t\trecLength += inputBuffer[0].length;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction exportBuffer(exportSampleRate) {\r\n\t\t\t\t\t\tvar mergedBuffers = mergeBuffers(recBuffer, recLength);\r\n\t\t\t\t\t\tvar downsampledBuffer = downsampleBuffer(\r\n\t\t\t\t\t\t\tmergedBuffers,\r\n\t\t\t\t\t\t\texportSampleRate\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tvar encodedWav = encodeWAV(downsampledBuffer);\r\n\t\t\t\t\t\tvar audioBlob = new Blob([encodedWav], {\r\n\t\t\t\t\t\t\ttype: 'application/octet-stream',\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tpostMessage(audioBlob);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction clear() {\r\n\t\t\t\t\t\trecLength = 0;\r\n\t\t\t\t\t\trecBuffer = [];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction downsampleBuffer(buffer, exportSampleRate) {\r\n\t\t\t\t\t\tif (exportSampleRate === recordSampleRate) {\r\n\t\t\t\t\t\t\treturn buffer;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar sampleRateRatio = recordSampleRate / exportSampleRate;\r\n\t\t\t\t\t\tvar newLength = Math.round(buffer.length / sampleRateRatio);\r\n\t\t\t\t\t\tvar result = new Float32Array(newLength);\r\n\t\t\t\t\t\tvar offsetResult = 0;\r\n\t\t\t\t\t\tvar offsetBuffer = 0;\r\n\t\t\t\t\t\twhile (offsetResult < result.length) {\r\n\t\t\t\t\t\t\tvar nextOffsetBuffer = Math.round(\r\n\t\t\t\t\t\t\t\t(offsetResult + 1) * sampleRateRatio\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tvar accum = 0,\r\n\t\t\t\t\t\t\t\tcount = 0;\r\n\t\t\t\t\t\t\tfor (\r\n\t\t\t\t\t\t\t\tvar i = offsetBuffer;\r\n\t\t\t\t\t\t\t\ti < nextOffsetBuffer && i < buffer.length;\r\n\t\t\t\t\t\t\t\ti++\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\taccum += buffer[i];\r\n\t\t\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult[offsetResult] = accum / count;\r\n\t\t\t\t\t\t\toffsetResult++;\r\n\t\t\t\t\t\t\toffsetBuffer = nextOffsetBuffer;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction mergeBuffers(bufferArray, recLength) {\r\n\t\t\t\t\t\tvar result = new Float32Array(recLength);\r\n\t\t\t\t\t\tvar offset = 0;\r\n\t\t\t\t\t\tfor (var i = 0; i < bufferArray.length; i++) {\r\n\t\t\t\t\t\t\tresult.set(bufferArray[i], offset);\r\n\t\t\t\t\t\t\toffset += bufferArray[i].length;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction floatTo16BitPCM(output, offset, input) {\r\n\t\t\t\t\t\tfor (var i = 0; i < input.length; i++, offset += 2) {\r\n\t\t\t\t\t\t\tvar s = Math.max(-1, Math.min(1, input[i]));\r\n\t\t\t\t\t\t\toutput.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction writeString(view, offset, string) {\r\n\t\t\t\t\t\tfor (var i = 0; i < string.length; i++) {\r\n\t\t\t\t\t\t\tview.setUint8(offset + i, string.charCodeAt(i));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction encodeWAV(samples) {\r\n\t\t\t\t\t\tvar buffer = new ArrayBuffer(44 + samples.length * 2);\r\n\t\t\t\t\t\tvar view = new DataView(buffer);\r\n\r\n\t\t\t\t\t\twriteString(view, 0, 'RIFF');\r\n\t\t\t\t\t\tview.setUint32(4, 32 + samples.length * 2, true);\r\n\t\t\t\t\t\twriteString(view, 8, 'WAVE');\r\n\t\t\t\t\t\twriteString(view, 12, 'fmt ');\r\n\t\t\t\t\t\tview.setUint32(16, 16, true);\r\n\t\t\t\t\t\tview.setUint16(20, 1, true);\r\n\t\t\t\t\t\tview.setUint16(22, 1, true);\r\n\t\t\t\t\t\tview.setUint32(24, recordSampleRate, true);\r\n\t\t\t\t\t\tview.setUint32(28, recordSampleRate * 2, true);\r\n\t\t\t\t\t\tview.setUint16(32, 2, true);\r\n\t\t\t\t\t\tview.setUint16(34, 16, true);\r\n\t\t\t\t\t\twriteString(view, 36, 'data');\r\n\t\t\t\t\t\tview.setUint32(40, samples.length * 2, true);\r\n\t\t\t\t\t\tfloatTo16BitPCM(view, 44, samples);\r\n\r\n\t\t\t\t\t\treturn view;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\t{},\r\n\t\t],\r\n\t},\r\n\t{},\r\n\t[3]\r\n);\r\n"]}