{"version":3,"file":"photo-picker.component.core.js","sourceRoot":"","sources":["../../../../../src/components/storage/photo-picker-component/photo-picker.component.core.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable\r\n/*\r\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\r\n * the License. A copy of the License is located at\r\n *\r\n *     http://aws.amazon.com/apache2.0/\r\n *\r\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\r\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\r\n * and limitations under the License.\r\n */\r\n// tslint:enable\r\n\r\nimport {\r\n\tComponent,\r\n\tInput,\r\n\tOutput,\r\n\tEventEmitter,\r\n\tOnInit,\r\n\tInject,\r\n} from '@angular/core';\r\nimport { AmplifyService } from '../../../providers/amplify.service';\r\n\r\nconst template = `\r\n<div class=\"amplify-photo-picker\">\r\n<div class=\"amplify-photo-picker-container\">\r\n  <div class=\"amplify-form-header\">Select Photos</div>\r\n  <div class=\"amplify-photo-picker-upload\" *ngIf=\"!hasPhoto\"></div>\r\n  <div class=\"amplify-photo-picker-preview\">\r\n    <img\r\n      class=\"amplify-photo-picker-preview\"\r\n      src=\"{{photoUrl}}\"\r\n      *ngIf=\"hasPhoto\"\r\n      (error)=\"onPhotoError()\"\r\n    />\r\n  </div>\r\n  <div class=\"amplify-upload-input\">\r\n    <input type=\"file\" \r\n      accept=\"image/*\"\r\n      (change)=\"pick($event)\"/>\r\n      <button \r\n        *ngIf=\"hasPhoto\" \r\n        class=\"amplify-form-button amplify-upload-button\" \r\n        (click)=\"uploadFile()\">\r\n        Upload Photo\r\n      </button>\r\n  </div>\r\n</div>\r\n<div class=\"amplify-alert\" *ngIf=\"errorMessage\">\r\n  <div class=\"amplify-alert-body\">\r\n    <span class=\"amplify-alert-icon\">&#9888;</span>\r\n    <div class=\"amplify-alert-message\">{{ errorMessage }}</div>\r\n    <a class=\"amplify-alert-close\" (click)=\"onAlertClose()\">&times;</a>\r\n  </div>\r\n</div>\r\n</div>\r\n`;\r\n\r\n@Component({\r\n\tselector: 'amplify-photo-picker-core',\r\n\ttemplate,\r\n})\r\nexport class PhotoPickerComponentCore implements OnInit {\r\n\tphotoUrl: string;\r\n\thasPhoto: boolean = false;\r\n\tuploading: boolean = false;\r\n\ts3ImageFile: any = null;\r\n\ts3ImagePath: string = '';\r\n\t_storageOptions: any = {};\r\n\terrorMessage: string;\r\n\tprotected logger: any;\r\n\r\n\tconstructor(@Inject(AmplifyService) public amplifyService: AmplifyService) {\r\n\t\tthis.logger = this.amplifyService.logger('PhotoPickerComponent');\r\n\t}\r\n\r\n\t@Input()\r\n\tset url(url: string) {\r\n\t\tthis.photoUrl = url;\r\n\t\tthis.hasPhoto = true;\r\n\t}\r\n\r\n\t@Input()\r\n\tset storageOptions(storageOptions: any) {\r\n\t\tthis._storageOptions = Object.assign(this._storageOptions, storageOptions);\r\n\t}\r\n\r\n\t@Input()\r\n\tset path(path: string) {\r\n\t\tthis.s3ImagePath = path;\r\n\t}\r\n\r\n\t@Input()\r\n\tset data(data: any) {\r\n\t\tthis.photoUrl = data.url;\r\n\t\tthis.s3ImagePath = data.path;\r\n\t\tthis._storageOptions = Object.assign(\r\n\t\t\tthis._storageOptions,\r\n\t\t\tdata.storageOptions\r\n\t\t);\r\n\t\tthis.hasPhoto = true;\r\n\t}\r\n\r\n\t@Output()\r\n\tpicked: EventEmitter<string> = new EventEmitter<string>();\r\n\r\n\t@Output()\r\n\tloaded: EventEmitter<string> = new EventEmitter<string>();\r\n\r\n\t@Output()\r\n\tuploaded: EventEmitter<Object> = new EventEmitter<Object>();\r\n\r\n\tngOnInit() {\r\n\t\tif (!this.amplifyService.storage()) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t'Storage module not registered on AmplifyService provider'\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tpick(evt) {\r\n\t\tconst file = evt.target.files[0];\r\n\t\tif (!file) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!this._storageOptions.contentType) {\r\n\t\t\tthis._storageOptions.contentType = file.type;\r\n\t\t}\r\n\t\tconst { name, size, type } = file;\r\n\t\tthis.picked.emit(file);\r\n\r\n\t\tthis.s3ImagePath = `${this.s3ImagePath}/${file.name}`;\r\n\t\tthis.s3ImageFile = file;\r\n\t\tconst that = this;\r\n\t\tconst reader = new FileReader();\r\n\t\treader.onload = function(e) {\r\n\t\t\tconst target: any = e.target;\r\n\t\t\tconst url = target.result;\r\n\t\t\tthat.photoUrl = url;\r\n\t\t\tthat.hasPhoto = true;\r\n\t\t\tthat.loaded.emit(url);\r\n\t\t};\r\n\t\treader.readAsDataURL(file);\r\n\t}\r\n\r\n\tuploadFile() {\r\n\t\tthis.uploading = true;\r\n\t\tthis.amplifyService\r\n\t\t\t.storage()\r\n\t\t\t.put(this.s3ImagePath, this.s3ImageFile, this._storageOptions)\r\n\t\t\t.then(result => {\r\n\t\t\t\tthis.uploaded.emit(result);\r\n\t\t\t\tthis.completeFileUpload();\r\n\t\t\t})\r\n\t\t\t.catch(error => {\r\n\t\t\t\tthis.completeFileUpload(error);\r\n\t\t\t});\r\n\t}\r\n\r\n\tcompleteFileUpload(error?: any) {\r\n\t\tif (error) {\r\n\t\t\treturn this._setError(error);\r\n\t\t}\r\n\t\tthis.s3ImagePath = '';\r\n\t\tthis.photoUrl = null;\r\n\t\tthis.s3ImageFile = null;\r\n\t\tthis.uploading = false;\r\n\t}\r\n\r\n\tonPhotoError() {\r\n\t\tthis.hasPhoto = false;\r\n\t}\r\n\r\n\tonAlertClose() {\r\n\t\tthis._setError(null);\r\n\t}\r\n\r\n\t_setError(err) {\r\n\t\tif (!err) {\r\n\t\t\tthis.errorMessage = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.errorMessage = err.message || err;\r\n\t}\r\n}\r\n"]}