{"version":3,"sources":["webpack:///./node_modules/@aws-amplify/ui-components/dist/esm-es5/amplify-chatbot.entry.js"],"names":["__awaiter","value","resolve","P","step","generator","reject","result","adopt","_arguments","__generator","_","label","sent","t","trys","ops","next","verb","g","Symbol","f","y","op","done","body","__spreadArrays","s","i","il","arguments","r","Array","k","a","j","jl","RECORDER_EXPORT_MIME_TYPE","DEFAULT_EXPORT_SAMPLE_RATE","FFT_SIZE","FFT_MAX_DECIBELS","FFT_MIN_DECIBELS","FFT_SMOOTHING_TIME_CONSTANT","mergeBuffers","offset","bufferArray","downsampleBuffer","exportSampleRate","sampleRateRatio","recordSampleRate","newLength","Math","buffer","offsetResult","offsetBuffer","nextOffsetBuffer","accum","count","floatTo16BitPCM","byteOffset","input","output","writeString","string","view","encodeWAV","audioSize","samples","fmtSize","dataSize","totalByteSize","exportBuffer","mergedBuffers","downsampledBuffer","encodedWav","audioBlob","type","logger","AudioRecorder","_this","_a","browserOrNode","window","audio","Promise","err_1","sourceNode","processorNode","stream","audioProcessingEvent","analyserNode","onSilence","visualizer","context","err_2","Date","myBlob","fileReader","successCallback","res","errorCallback","rej","analyser","bufferLength","dataArray","amplitude","time","curr_value_time","newtime","elapsedTime","blob","visualize","canvas","width","height","canvasCtx","draw","color","getComputedStyle","document","sliceWidth","x","requestAnimationFrame","amplifyChatbotCss","ChatState","MessageFrom","ChatErrorType","AmplifyChatbot","registerInstance","Translations","messageList","h","message","from","client","createEvent","class_1","Interactions","silenceThreshold","onComplete","data","err","event","target","errorType","text","response","err_3","interactionsMessage","content","options","messageType","err_4","dialogState","error","visualization","cancelButton","handleButtonClick","variant","icon","inputPlaceholder","textInput","placeholder","I18n","description","handleInputChange","disabled","textEnabled","micButton","Initial","sendButton","handleClose","name","onSubmit","Object","get","getElement","enumerable","configurable"],"mappings":"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","file":"16.js","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport { r as registerInstance, h, c as createEvent, H as Host, g as getElement } from './index-83f2275b.js';\r\nimport { Logger, browserOrNode, I18n } from '@aws-amplify/core';\r\nimport '@aws-amplify/auth';\r\nimport { T as Translations } from './Translations-97eed81d.js';\r\nimport { d as NO_INTERACTIONS_MODULE_FOUND } from './constants-727dee2c.js';\r\nimport { Interactions } from '@aws-amplify/interactions';\r\n// AudioRecorder settings\r\nvar RECORDER_EXPORT_MIME_TYPE = 'application/octet-stream';\r\nvar DEFAULT_EXPORT_SAMPLE_RATE = 16000;\r\nvar FFT_SIZE = 2048; // window size in samples for Fast Fourier Transform (FFT)\r\nvar FFT_MAX_DECIBELS = -10; // maximum power value in the scaling range for the FFT analysis data\r\nvar FFT_MIN_DECIBELS = -90; // minimum power value in the scaling range for the FFT analysis data\r\nvar FFT_SMOOTHING_TIME_CONSTANT = 0.85; // averaging constant with the last analysis frame\r\n/**\r\n * Merges multiple buffers into one.\r\n */\r\nvar mergeBuffers = function (bufferArray, recLength) {\r\n    var result = new Float32Array(recLength);\r\n    var offset = 0;\r\n    for (var i = 0; i < bufferArray.length; i++) {\r\n        result.set(bufferArray[i], offset);\r\n        offset += bufferArray[i].length;\r\n    }\r\n    return result;\r\n};\r\n/**\r\n * Downsamples audio to desired export sample rate.\r\n */\r\nvar downsampleBuffer = function (buffer, recordSampleRate, exportSampleRate) {\r\n    if (exportSampleRate === recordSampleRate) {\r\n        return buffer;\r\n    }\r\n    var sampleRateRatio = recordSampleRate / exportSampleRate;\r\n    var newLength = Math.round(buffer.length / sampleRateRatio);\r\n    var result = new Float32Array(newLength);\r\n    var offsetResult = 0;\r\n    var offsetBuffer = 0;\r\n    while (offsetResult < result.length) {\r\n        var nextOffsetBuffer = Math.round((offsetResult + 1) * sampleRateRatio);\r\n        var accum = 0, count = 0;\r\n        for (var i = offsetBuffer; i < nextOffsetBuffer && i < buffer.length; i++) {\r\n            accum += buffer[i];\r\n            count++;\r\n        }\r\n        result[offsetResult] = accum / count;\r\n        offsetResult++;\r\n        offsetBuffer = nextOffsetBuffer;\r\n    }\r\n    return result;\r\n};\r\n/**\r\n * converts raw audio values to 16 bit pcm.\r\n */\r\nvar floatTo16BitPCM = function (output, offset, input) {\r\n    var byteOffset = offset;\r\n    for (var i = 0; i < input.length; i++, byteOffset += 2) {\r\n        var s = Math.max(-1, Math.min(1, input[i]));\r\n        output.setInt16(byteOffset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\r\n    }\r\n};\r\n/**\r\n * Write given strings in big-endian order.\r\n */\r\nvar writeString = function (view, offset, string) {\r\n    for (var i = 0; i < string.length; i++) {\r\n        view.setUint8(offset + i, string.charCodeAt(i));\r\n    }\r\n};\r\n/**\r\n * Encodes raw pcm audio into a wav file.\r\n */\r\nvar encodeWAV = function (samples, exportSampleRate) {\r\n    /**\r\n     * WAV file consists of three parts: RIFF header, WAVE subchunk, and data subchunk. We precompute the size of them.\r\n     */\r\n    var audioSize = samples.length * 2; // We use 16-bit samples, so we have (2 * sampleLength) bytes.\r\n    var fmtSize = 24; // Byte size of the fmt subchunk: 24 bytes that the audio information that we'll set below.\r\n    var dataSize = 8 + audioSize; // Byte size of the data subchunk: raw sound data plus 8 bytes for the subchunk descriptions.\r\n    var totalByteSize = 12 + fmtSize + dataSize; // Byte size of the whole file, including the chunk header / descriptor.\r\n    // create DataView object to write byte values into\r\n    var buffer = new ArrayBuffer(totalByteSize); // buffer to write the chunk values in.\r\n    var view = new DataView(buffer);\r\n    /**\r\n     * Start writing the .wav file. We write top to bottom, so byte offset (first numeric argument) increases strictly.\r\n     */\r\n    // RIFF header\r\n    writeString(view, 0, 'RIFF'); // At offset 0, write the letters \"RIFF\"\r\n    view.setUint32(4, fmtSize + dataSize, true); // At offset 4, write the size of fmt and data chunk size combined.\r\n    writeString(view, 8, 'WAVE'); // At offset 8, write the format type \"WAVE\"\r\n    // fmt subchunk\r\n    writeString(view, 12, 'fmt '); //chunkdId 'fmt '\r\n    view.setUint32(16, fmtSize - 8, true); // fmt subchunk size below this value. We set 8 bytes already, so subtract 8 bytes from fmtSize.\r\n    view.setUint16(20, 1, true); // Audio format code, which is 1 for PCM.\r\n    view.setUint16(22, 1, true); // Number of audio channels. We use mono, ie 1.\r\n    view.setUint32(24, exportSampleRate, true); // Sample rate of the audio file.\r\n    view.setUint32(28, exportSampleRate * 2, true); // Data rate, or # of data bytes per second. Since each sample is 2 bytes, this is 2 * sampleRate.\r\n    view.setUint16(32, 2, true); // block align, # of bytes per sample including all channels, ie. 2 bytes.\r\n    view.setUint16(34, 16, true); // bits per sample, ie. 16 bits\r\n    // data subchunk\r\n    writeString(view, 36, 'data'); // write the chunkId 'data'\r\n    view.setUint32(40, audioSize, true); // Audio byte size\r\n    floatTo16BitPCM(view, 44, samples); // raw pcm values then go here.\r\n    return view;\r\n};\r\n/**\r\n * Given arrays of raw pcm audio, downsamples the audio to desired sample rate and encodes it to a wav audio file.\r\n *\r\n * @param recBuffer {Float32Array[]} - 2d float array containing the recorded raw audio\r\n * @param recLength {number} - total length of recorded audio\r\n * @param recordSampleRate {number} - sample rate of the recorded audio\r\n * @param exportSampleRate {number} - desired sample rate of the exported file\r\n */\r\nvar exportBuffer = function (recBuffer, recLength, recordSampleRate, exportSampleRate) {\r\n    var mergedBuffers = mergeBuffers(recBuffer, recLength);\r\n    var downsampledBuffer = downsampleBuffer(mergedBuffers, recordSampleRate, exportSampleRate);\r\n    var encodedWav = encodeWAV(downsampledBuffer, exportSampleRate);\r\n    var audioBlob = new Blob([encodedWav], {\r\n        type: RECORDER_EXPORT_MIME_TYPE,\r\n    });\r\n    return audioBlob;\r\n};\r\nvar logger = new Logger('AudioRecorder');\r\nvar AudioRecorder = /** @class */ (function () {\r\n    function AudioRecorder(options) {\r\n        // input mic stream is stored in a buffer\r\n        this.streamBuffer = [];\r\n        this.streamBufferLength = 0;\r\n        this.recording = false;\r\n        this.options = options;\r\n    }\r\n    /**\r\n     * This must be called first to enable audio context and request microphone access.\r\n     * Once access granted, it connects all the necessary audio nodes to the context so that it can begin recording or playing.\r\n     */\r\n    AudioRecorder.prototype.init = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!browserOrNode().isBrowser) return [3 /*break*/, 2];\r\n                        window.AudioContext =\r\n                            window.AudioContext || window.webkitAudioContext;\r\n                        this.audioContext = new AudioContext();\r\n                        return [4 /*yield*/, navigator.mediaDevices\r\n                                .getUserMedia({ audio: true })\r\n                                .then(function (stream) {\r\n                                _this.audioSupported = true;\r\n                                _this.setupAudioNodes(stream);\r\n                            })\r\n                                .catch(function () {\r\n                                _this.audioSupported = false;\r\n                                return Promise.reject('Audio is not supported');\r\n                            })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        this.audioSupported = false;\r\n                        return [2 /*return*/, Promise.reject('Audio is not supported')];\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Setup audio nodes after successful `init`.\r\n     */\r\n    AudioRecorder.prototype.setupAudioNodes = function (stream) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var err_1, sourceNode, processorNode, analyserNode;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4 /*yield*/, this.audioContext.resume()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        err_1 = _a.sent();\r\n                        logger.error(err_1);\r\n                        return [3 /*break*/, 3];\r\n                    case 3:\r\n                        sourceNode = this.audioContext.createMediaStreamSource(stream);\r\n                        processorNode = this.audioContext.createScriptProcessor(4096, 1, 1);\r\n                        processorNode.onaudioprocess = function (audioProcessingEvent) {\r\n                            if (!_this.recording)\r\n                                return;\r\n                            var stream = audioProcessingEvent.inputBuffer.getChannelData(0);\r\n                            _this.streamBuffer.push(new Float32Array(stream)); // set to a copy of the stream\r\n                            _this.streamBufferLength += stream.length;\r\n                            _this.analyse();\r\n                        };\r\n                        analyserNode = this.audioContext.createAnalyser();\r\n                        analyserNode.minDecibels = FFT_MIN_DECIBELS;\r\n                        analyserNode.maxDecibels = FFT_MAX_DECIBELS;\r\n                        analyserNode.smoothingTimeConstant = FFT_SMOOTHING_TIME_CONSTANT;\r\n                        sourceNode.connect(analyserNode);\r\n                        analyserNode.connect(processorNode);\r\n                        processorNode.connect(sourceNode.context.destination);\r\n                        this.analyserNode = analyserNode;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Start recording audio and listen for silence.\r\n     *\r\n     * @param onSilence {SilenceHandler} - called whenever silence is detected\r\n     * @param visualizer {Visualizer} - called with audio data on each audio process to be used for visualization.\r\n     */\r\n    AudioRecorder.prototype.startRecording = function (onSilence, visualizer) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var context, err_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.recording || !this.audioSupported)\r\n                            return [2 /*return*/];\r\n                        this.onSilence = onSilence || function () { };\r\n                        this.visualizer = visualizer || function () { };\r\n                        context = this.audioContext;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, context.resume()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        err_2 = _a.sent();\r\n                        logger.error(err_2);\r\n                        return [3 /*break*/, 4];\r\n                    case 4:\r\n                        this.start = Date.now();\r\n                        this.recording = true;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Pause recording\r\n     */\r\n    AudioRecorder.prototype.stopRecording = function () {\r\n        if (!this.audioSupported)\r\n            return;\r\n        this.recording = false;\r\n    };\r\n    /**\r\n     * Pause recording and clear audio buffer\r\n     */\r\n    AudioRecorder.prototype.clear = function () {\r\n        this.stopRecording();\r\n        this.streamBufferLength = 0;\r\n        this.streamBuffer = [];\r\n    };\r\n    /**\r\n     * Plays given audioStream with audioContext\r\n     *\r\n     * @param buffer {Uint8Array} - audioStream to be played\r\n     */\r\n    AudioRecorder.prototype.play = function (buffer) {\r\n        var _this = this;\r\n        if (!buffer || !this.audioSupported)\r\n            return;\r\n        var myBlob = new Blob([buffer]);\r\n        return new Promise(function (res, rej) {\r\n            var fileReader = new FileReader();\r\n            fileReader.onload = function () {\r\n                if (_this.playbackSource)\r\n                    _this.playbackSource.disconnect(); // disconnect previous playback source\r\n                _this.playbackSource = _this.audioContext.createBufferSource();\r\n                var successCallback = function (buf) {\r\n                    _this.playbackSource.buffer = buf;\r\n                    _this.playbackSource.connect(_this.audioContext.destination);\r\n                    _this.playbackSource.onended = function () {\r\n                        return res();\r\n                    };\r\n                    _this.playbackSource.start(0);\r\n                };\r\n                var errorCallback = function (err) {\r\n                    return rej(err);\r\n                };\r\n                _this.audioContext.decodeAudioData(fileReader.result, successCallback, errorCallback);\r\n            };\r\n            fileReader.onerror = function () { return rej(); };\r\n            fileReader.readAsArrayBuffer(myBlob);\r\n        });\r\n    };\r\n    /**\r\n     * Stops playing audio if there's a playback source connected.\r\n     */\r\n    AudioRecorder.prototype.stop = function () {\r\n        if (this.playbackSource) {\r\n            this.playbackSource.stop();\r\n        }\r\n    };\r\n    /**\r\n     * Called after each audioProcess. Check for silence and give fft time domain data to visualizer.\r\n     */\r\n    AudioRecorder.prototype.analyse = function () {\r\n        if (!this.audioSupported)\r\n            return;\r\n        var analyser = this.analyserNode;\r\n        analyser.fftSize = FFT_SIZE;\r\n        var bufferLength = analyser.fftSize;\r\n        var dataArray = new Uint8Array(bufferLength);\r\n        var amplitude = this.options.amplitude;\r\n        var time = this.options.time;\r\n        analyser.getByteTimeDomainData(dataArray);\r\n        this.visualizer(dataArray, bufferLength);\r\n        for (var i = 0; i < bufferLength; i++) {\r\n            // Normalize between -1 and 1.\r\n            var curr_value_time = dataArray[i] / 128 - 1.0;\r\n            if (curr_value_time > amplitude || curr_value_time < -1 * amplitude) {\r\n                this.start = Date.now();\r\n            }\r\n        }\r\n        var newtime = Date.now();\r\n        var elapsedTime = newtime - this.start;\r\n        if (elapsedTime > time) {\r\n            this.onSilence();\r\n        }\r\n    };\r\n    /**\r\n     * Encodes recorded buffer to a wav file and exports it to a blob.\r\n     *\r\n     * @param exportSampleRate {number} - desired sample rate of the exported buffer\r\n     */\r\n    AudioRecorder.prototype.exportWAV = function (exportSampleRate) {\r\n        if (exportSampleRate === void 0) { exportSampleRate = DEFAULT_EXPORT_SAMPLE_RATE; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var recordSampleRate, blob;\r\n            return __generator(this, function (_a) {\r\n                if (!this.audioSupported)\r\n                    return [2 /*return*/];\r\n                recordSampleRate = this.audioContext.sampleRate;\r\n                blob = exportBuffer(this.streamBuffer, this.streamBufferLength, recordSampleRate, exportSampleRate);\r\n                this.clear();\r\n                return [2 /*return*/, blob];\r\n            });\r\n        });\r\n    };\r\n    return AudioRecorder;\r\n}());\r\nvar visualize = function (dataArray, bufferLength, canvas) {\r\n    if (!canvas)\r\n        return;\r\n    if (!browserOrNode().isBrowser)\r\n        throw new Error('Visualization is not supported on non-browsers.');\r\n    var _a = canvas.getBoundingClientRect(), width = _a.width, height = _a.height;\r\n    // need to update the default canvas width and height\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    var canvasCtx = canvas.getContext('2d');\r\n    canvasCtx.fillStyle = 'white';\r\n    canvasCtx.clearRect(0, 0, width, height);\r\n    var draw = function () {\r\n        canvasCtx.fillRect(0, 0, width, height);\r\n        canvasCtx.lineWidth = 1;\r\n        var color = getComputedStyle(document.documentElement).getPropertyValue('--amplify-primary-color');\r\n        canvasCtx.strokeStyle = !color || color === '' ? '#ff9900' : color; // TODO: try separate css variable\r\n        canvasCtx.beginPath();\r\n        var sliceWidth = (width * 1.0) / bufferLength;\r\n        var x = 0;\r\n        for (var i = 0; i < bufferLength || i % 3 === 0; i++) {\r\n            var value = dataArray[i] / 128.0;\r\n            var y = (value * height) / 2;\r\n            if (i === 0) {\r\n                canvasCtx.moveTo(x, y);\r\n            }\r\n            else {\r\n                canvasCtx.lineTo(x, y);\r\n            }\r\n            x += sliceWidth;\r\n        }\r\n        canvasCtx.lineTo(canvas.width, canvas.height / 2);\r\n        canvasCtx.stroke();\r\n    };\r\n    // Register our draw function with requestAnimationFrame.\r\n    requestAnimationFrame(draw);\r\n};\r\nvar amplifyChatbotCss = \".bot .dot{background-color:var(--bot-dot-color)}.user .dot{background-color:var(--user-dot-color)}.dot-flashing{width:2.625rem}.dot-flashing .dot{display:inline-block;width:0.625rem;height:0.625rem;border-radius:10rem;opacity:0.65}.dot-flashing .left{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:0s;animation-delay:0s}.dot-flashing .middle{margin-left:0.375rem;margin-right:0.375rem;-webkit-animation:dot-flashing 1s infinite linear alternate;animation:dot-flashing 1s infinite linear alternate;-webkit-animation-delay:0.5s;animation-delay:0.5s}.dot-flashing .right{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}@keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}:host{--width:28.75rem;--height:37.5rem;--header-color:var(--amplify-secondary-color);--header-size:var(--amplify-text-lg);--bot-background-color:rgb(230, 230, 230);--bot-text-color:black;--bot-dot-color:var(--bot-text-color);--user-background-color:var(--amplify-blue);--user-text-color:var(--amplify-white);--user-dot-color:var(--user-text-color)}.amplify-chatbot{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-direction:column;flex-direction:column;background-color:var(--background-color);border-radius:0.375rem;-webkit-box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);-webkit-box-sizing:border-box;box-sizing:border-box;font-family:var(--amplify-font-family);margin-bottom:1rem;width:100%;height:var(--height);max-width:var(--width)}@media (min-width: 672px){.amplify-chatbot{width:var(--width)}}.header{padding:1.25rem 0.375rem 1.25rem 0.375rem;color:var(--header-color);font-size:var(--header-size);font-weight:bold;text-align:center;word-wrap:break-word}.body{border-top:0.0625rem solid rgba(0, 0, 0, 0.05);padding:1.5rem 1rem 0 1rem;display:-ms-flexbox;display:flex;-ms-flex-positive:1;flex-grow:1;-ms-flex-direction:column;flex-direction:column;overflow:auto}.bubble{max-width:100%;padding:0.8em 1.4em;text-align:left;word-wrap:break-word;margin-bottom:0.625rem}.bot{margin-right:auto;background-color:var(--bot-background-color);color:var(--bot-text-color);border-radius:1.5rem 1.5rem 1.5rem 0}.user{margin-left:auto;background-color:var(--user-background-color);color:var(--user-text-color);border-radius:1.5rem 1.5rem 0 1.5rem}.footer{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;border-top:0.062rem solid rgba(0, 0, 0, 0.05);padding-right:0.625rem;min-height:3.125rem}.footer amplify-input{--border:none;--margin:0;-ms-flex-positive:1;flex-grow:1}canvas{margin-left:0.625rem;margin-right:0.625rem;-ms-flex-positive:1;flex-grow:1;height:3.125rem}.icon-button{--icon-height:1.25rem;--icon-fill:var(--amplify-primary-color);--padding:0.625rem;--width:auto}\";\r\n// enum for possible bot states\r\nvar ChatState;\r\n(function (ChatState) {\r\n    ChatState[ChatState[\"Initial\"] = 0] = \"Initial\";\r\n    ChatState[ChatState[\"Listening\"] = 1] = \"Listening\";\r\n    ChatState[ChatState[\"SendingText\"] = 2] = \"SendingText\";\r\n    ChatState[ChatState[\"SendingVoice\"] = 3] = \"SendingVoice\";\r\n    ChatState[ChatState[\"Error\"] = 4] = \"Error\";\r\n})(ChatState || (ChatState = {}));\r\n// Message types\r\nvar MessageFrom;\r\n(function (MessageFrom) {\r\n    MessageFrom[\"Bot\"] = \"bot\";\r\n    MessageFrom[\"User\"] = \"user\";\r\n})(MessageFrom || (MessageFrom = {}));\r\n// Error types\r\nvar ChatErrorType;\r\n(function (ChatErrorType) {\r\n    ChatErrorType[ChatErrorType[\"Recoverable\"] = 0] = \"Recoverable\";\r\n    ChatErrorType[ChatErrorType[\"Unrecoverable\"] = 1] = \"Unrecoverable\";\r\n})(ChatErrorType || (ChatErrorType = {}));\r\nvar AmplifyChatbot = /** @class */ (function () {\r\n    function class_1(hostRef) {\r\n        var _this = this;\r\n        registerInstance(this, hostRef);\r\n        /** Clear messages when conversation finishes */\r\n        this.clearOnComplete = false;\r\n        /** Continue listening to users after they send the message */\r\n        this.conversationModeOn = false;\r\n        /** Text placed in the top header */\r\n        this.botTitle = Translations.CHATBOT_TITLE;\r\n        /** Whether voice chat is enabled */\r\n        this.voiceEnabled = false;\r\n        /** Whether text chat is enabled */\r\n        this.textEnabled = true;\r\n        /** Amount of silence (in ms) to wait for */\r\n        this.silenceTime = 1500;\r\n        /** Noise threshold between -1 and 1. Anything below is considered a silence. */\r\n        this.silenceThreshold = 0.2;\r\n        /** Messages in current session */\r\n        this.messages = [];\r\n        /** Text input box value  */\r\n        this.text = '';\r\n        /** Current app state */\r\n        this.chatState = ChatState.Initial;\r\n        /**\r\n         * Rendering methods\r\n         */\r\n        this.messageJSX = function (messages) {\r\n            var messageList = messages.map(function (message) { return (h(\"div\", { class: \"bubble \" + message.from }, message.content)); });\r\n            if (_this.chatState === ChatState.SendingText ||\r\n                _this.chatState === ChatState.SendingVoice) {\r\n                // if waiting for voice message, show animation on user side because app is waiting for transcript. Else put it on bot side.\r\n                var client = _this.chatState === ChatState.SendingText\r\n                    ? MessageFrom.Bot\r\n                    : MessageFrom.User;\r\n                messageList.push(h(\"div\", { class: \"bubble \" + client }, h(\"div\", { class: \"dot-flashing \" + client }, h(\"span\", { class: \"dot left\" }), h(\"span\", { class: \"dot middle\" }), h(\"span\", { class: \"dot right\" }))));\r\n            }\r\n            return messageList;\r\n        };\r\n        this.chatCompleted = createEvent(this, \"chatCompleted\", 7);\r\n    }\r\n    // Occurs when user presses enter in input box\r\n    class_1.prototype.submitHandler = function (_event) {\r\n        this.sendTextMessage();\r\n    };\r\n    /**\r\n     * Lifecycle functions\r\n     */\r\n    class_1.prototype.componentWillLoad = function () {\r\n        if (!Interactions || typeof Interactions.onComplete !== 'function') {\r\n            throw new Error(NO_INTERACTIONS_MODULE_FOUND);\r\n        }\r\n        this.validateProps();\r\n    };\r\n    class_1.prototype.componentDidRender = function () {\r\n        // scroll to the bottom if necessary\r\n        var body = this.element.shadowRoot.querySelector('.body');\r\n        body.scrollTop = body.scrollHeight;\r\n    };\r\n    class_1.prototype.validateProps = function () {\r\n        var _this = this;\r\n        if (!this.voiceEnabled && !this.textEnabled) {\r\n            this.setError(Translations.CHAT_DISABLED_ERROR, ChatErrorType.Unrecoverable);\r\n            return;\r\n        }\r\n        else if (!this.botName) {\r\n            this.setError(Translations.NO_BOT_NAME_ERROR, ChatErrorType.Unrecoverable);\r\n            return;\r\n        }\r\n        if (this.welcomeMessage)\r\n            this.appendToChat(this.welcomeMessage, MessageFrom.Bot);\r\n        // Initialize AudioRecorder if voice is enabled\r\n        if (this.voiceEnabled) {\r\n            this.audioRecorder = new AudioRecorder({\r\n                time: this.silenceTime,\r\n                amplitude: this.silenceThreshold,\r\n            });\r\n            this.audioRecorder.init().catch(function (err) {\r\n                _this.setError(err, ChatErrorType.Recoverable);\r\n            });\r\n        }\r\n        // Callback function to be called after chat is completed\r\n        var onComplete = function (err, data) {\r\n            _this.chatCompleted.emit({\r\n                data: data,\r\n                err: err,\r\n            });\r\n            if (_this.clearOnComplete) {\r\n                _this.reset();\r\n            }\r\n            else {\r\n                _this.chatState = ChatState.Initial;\r\n            }\r\n        };\r\n        try {\r\n            Interactions.onComplete(this.botName, onComplete);\r\n        }\r\n        catch (err) {\r\n            this.setError(err, ChatErrorType.Unrecoverable);\r\n        }\r\n    };\r\n    /**\r\n     * Handlers\r\n     */\r\n    class_1.prototype.handleSubmit = function (event) {\r\n        event.preventDefault();\r\n        this.sendTextMessage();\r\n    };\r\n    class_1.prototype.handleMicButton = function () {\r\n        var _this = this;\r\n        if (this.chatState !== ChatState.Initial)\r\n            return;\r\n        this.audioRecorder.stop();\r\n        this.chatState = ChatState.Listening;\r\n        this.audioRecorder.startRecording(function () { return _this.handleSilence(); }, function (data, length) { return _this.visualizer(data, length); });\r\n    };\r\n    class_1.prototype.handleSilence = function () {\r\n        var _this = this;\r\n        this.chatState = ChatState.SendingVoice;\r\n        this.audioRecorder.stopRecording();\r\n        this.audioRecorder.exportWAV().then(function (blob) {\r\n            _this.sendVoiceMessage(blob);\r\n        });\r\n    };\r\n    class_1.prototype.handleTextChange = function (event) {\r\n        var target = event.target;\r\n        this.text = target.value;\r\n    };\r\n    class_1.prototype.handleCancelButton = function () {\r\n        this.audioRecorder.clear();\r\n        this.chatState = ChatState.Initial;\r\n    };\r\n    class_1.prototype.handleToastClose = function (errorType) {\r\n        this.error = undefined; // clear error\r\n        // if error is recoverable, reset the app state to initial\r\n        if (errorType === ChatErrorType.Recoverable) {\r\n            this.chatState = ChatState.Initial;\r\n        }\r\n    };\r\n    /**\r\n     * Visualization\r\n     */\r\n    class_1.prototype.visualizer = function (dataArray, bufferLength) {\r\n        var canvas = this.element.shadowRoot.querySelector('canvas');\r\n        visualize(dataArray, bufferLength, canvas);\r\n    };\r\n    /**\r\n     * Interactions helpers\r\n     */\r\n    class_1.prototype.sendTextMessage = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var text, response, err_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.text.length === 0 || this.chatState !== ChatState.Initial)\r\n                            return [2 /*return*/];\r\n                        text = this.text;\r\n                        this.text = '';\r\n                        this.appendToChat(text, MessageFrom.User);\r\n                        this.chatState = ChatState.SendingText;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, Interactions.send(this.botName, text)];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        err_3 = _a.sent();\r\n                        this.setError(err_3, ChatErrorType.Recoverable);\r\n                        return [2 /*return*/];\r\n                    case 4:\r\n                        if (response.message) {\r\n                            this.appendToChat(response.message, MessageFrom.Bot);\r\n                        }\r\n                        this.chatState = ChatState.Initial;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    class_1.prototype.sendVoiceMessage = function (audioInput) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var interactionsMessage, response, err_4, dialogState;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        interactionsMessage = {\r\n                            content: audioInput,\r\n                            options: {\r\n                                messageType: 'voice',\r\n                            },\r\n                        };\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, Interactions.send(this.botName, interactionsMessage)];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        err_4 = _a.sent();\r\n                        this.setError(err_4, ChatErrorType.Recoverable);\r\n                        return [2 /*return*/];\r\n                    case 4:\r\n                        this.chatState = ChatState.Initial;\r\n                        dialogState = response.dialogState;\r\n                        if (response.inputTranscript)\r\n                            this.appendToChat(response.inputTranscript, MessageFrom.User);\r\n                        this.appendToChat(response.message, MessageFrom.Bot);\r\n                        return [4 /*yield*/, this.audioRecorder\r\n                                .play(response.audioStream)\r\n                                .then(function () {\r\n                                // if conversationMode is on, chat is incomplete, and mic button isn't pressed yet, resume listening.\r\n                                if (_this.conversationModeOn &&\r\n                                    dialogState !== 'Fulfilled' &&\r\n                                    dialogState !== 'Failed' &&\r\n                                    _this.chatState === ChatState.Initial) {\r\n                                    _this.handleMicButton();\r\n                                }\r\n                            })\r\n                                .catch(function (err) { return _this.setError(err, ChatErrorType.Recoverable); })];\r\n                    case 5:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    class_1.prototype.appendToChat = function (content, from) {\r\n        this.messages = __spreadArrays(this.messages, [\r\n            {\r\n                content: content,\r\n                from: from,\r\n            },\r\n        ]);\r\n    };\r\n    /**\r\n     * State control methods\r\n     */\r\n    class_1.prototype.setError = function (error, errorType) {\r\n        var message = typeof error === 'string' ? error : error.message;\r\n        this.chatState = ChatState.Error;\r\n        this.error = { message: message, errorType: errorType };\r\n    };\r\n    class_1.prototype.reset = function () {\r\n        this.chatState = ChatState.Initial;\r\n        this.text = '';\r\n        this.error = undefined;\r\n        this.messages = [];\r\n        if (this.welcomeMessage)\r\n            this.appendToChat(this.welcomeMessage, MessageFrom.Bot);\r\n        this.audioRecorder && this.audioRecorder.clear();\r\n    };\r\n    class_1.prototype.listeningFooterJSX = function () {\r\n        var _this = this;\r\n        var visualization = h(\"canvas\", { height: \"50\" });\r\n        var cancelButton = (h(\"amplify-button\", { \"data-test\": \"chatbot-cancel-button\", handleButtonClick: function () { return _this.handleCancelButton(); }, class: \"icon-button\", variant: \"icon\", icon: \"ban\" }));\r\n        return [visualization, cancelButton];\r\n    };\r\n    class_1.prototype.footerJSX = function () {\r\n        var _this = this;\r\n        if (this.chatState === ChatState.Listening)\r\n            return this.listeningFooterJSX();\r\n        var inputPlaceholder = this.textEnabled\r\n            ? Translations.TEXT_INPUT_PLACEHOLDER\r\n            : Translations.VOICE_INPUT_PLACEHOLDER;\r\n        var textInput = (h(\"amplify-input\", { placeholder: I18n.get(inputPlaceholder), description: \"text\", handleInputChange: function (evt) { return _this.handleTextChange(evt); }, value: this.text, disabled: this.chatState === ChatState.Error || !this.textEnabled }));\r\n        var micButton = this.voiceEnabled && (h(\"amplify-button\", { \"data-test\": \"chatbot-mic-button\", handleButtonClick: function () { return _this.handleMicButton(); }, class: \"icon-button\", variant: \"icon\", icon: \"microphone\", disabled: this.chatState === ChatState.Error ||\r\n                this.chatState !== ChatState.Initial }));\r\n        var sendButton = this.textEnabled && (h(\"amplify-button\", { \"data-test\": \"chatbot-send-button\", class: \"icon-button\", variant: \"icon\", icon: \"send\", handleButtonClick: function () { return _this.sendTextMessage(); }, disabled: this.chatState === ChatState.Error ||\r\n                this.chatState !== ChatState.Initial }));\r\n        return [textInput, micButton, sendButton];\r\n    };\r\n    class_1.prototype.errorToast = function () {\r\n        var _this = this;\r\n        if (!this.error)\r\n            return;\r\n        var _a = this.error, message = _a.message, errorType = _a.errorType;\r\n        return (h(\"amplify-toast\", { message: I18n.get(message), handleClose: function () { return _this.handleToastClose(errorType); } }));\r\n    };\r\n    class_1.prototype.render = function () {\r\n        var _this = this;\r\n        return (h(Host, null, h(\"div\", { class: \"amplify-chatbot\" }, h(\"slot\", { name: \"header\" }, h(\"div\", { class: \"header\", \"data-test\": \"chatbot-header\" }, I18n.get(this.botTitle))), h(\"div\", { class: \"body\", \"data-test\": \"chatbot-body\" }, this.messageJSX(this.messages)), h(\"form\", { onSubmit: function (e) { return _this.handleSubmit(e); } }, h(\"div\", { class: \"footer\", \"data-test\": \"chatbot-footer\" }, this.footerJSX())), this.errorToast())));\r\n    };\r\n    Object.defineProperty(class_1.prototype, \"element\", {\r\n        get: function () { return getElement(this); },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return class_1;\r\n}());\r\nAmplifyChatbot.style = amplifyChatbotCss;\r\nexport { AmplifyChatbot as amplify_chatbot };\r\n"],"sourceRoot":""}